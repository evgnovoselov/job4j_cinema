# job4j_cinema

[![Java CI with Maven](https://github.com/evgnovoselov/job4j_cinema/actions/workflows/maven.yml/badge.svg)](https://github.com/evgnovoselov/job4j_cinema/actions/workflows/maven.yml)
[![codecov](https://codecov.io/gh/evgnovoselov/job4j_cinema/branch/master/graph/badge.svg?token=CTZjFEJLum)](https://codecov.io/gh/evgnovoselov/job4j_cinema)

## Описание проекта

Данный проект представляет реализацию кинотеатра с выбором места на сеанс фильма и приобретение билета.

В системе есть авторизация и регистрации пользователя, и покупка билета возможна только
авторизованному пользователю.

Используя **Docker Compose** и демонстрационные данные, можно легко запустить проект и посмотреть его 
работоспособность. Демонстрационные данные находятся в файлах миграции **Liquibase** и дополнительных ресурсах
в папке `files`. Сеансы фильмов заполнены по _диаграмме Ганта_ находящаяся в файле `film_sessions.ods`.

Проект использует пул соединения с базой данных и слоистую структуру разбитую по пакетам.
Так же проект имеет большой процент покрытия тестами, что облегчает добавление нового функционала или
изменение прежнего. За генерацию ответов на запросы браузера используется серверный шаблонизатор Thymeleaf.

## Стек технологий

При разработке и тестировании использовались следующие технологии:

* Java 17
* Spring Boot 3.1.1
* Liquibase 4.20.0
* PostgreSQL JDBC Driver 42.6.0
* Apache Commons DBCP 2.9.0
* Sql2o 1.6.0
* H2database 2.1.214
* Thymeleaf 3.1.1
* WebJars 0.52 (Для добавления библиотек: Bootstrap 5.3.0 и Bootstrap Icons 1.10.5)
* Checkstyle 3.3.0
* JaCoCo 0.8.10
* JUnit 5.9.3
* Mockito 5.3.1
* AssertJ 3.24.2
* Docker Compose 1.25.0 (Образы PostgreSQL 15 и Adminer 4)

## Требования к окружению

Для запуска проекта необходимо следующее программное обеспечение:

* Java 17
* Maven 3.9.3
* PostgreSQL 15 или Docker Compose 1.25.0

## Запуск проекта

Следующие этапы помогут запустить тест проекта и сам сервис кинотеатра.

### Запуск тестов проекта

Для тестов используется база данных **H2database**, которая настроена хранить данные в файле,
поэтому создается два вспомогательных файла для работы тестов `testdb.mv.db` и `testdb.trace.db`.

Для запуска теста нужно выполнить следующие команды:

Сначала необходимо произвести миграцию с помощью **Liquibase**,
**H2database** создаст 2 файла `testdb.mv.db` и `testdb.trace.db` для миграций, с помощью команды:

```text
mvn liquibase:update --activate-profiles test
```

Далее запустим тесты:

```text
mvn test
```

Данная команда запустит тестирование проекта и будет показан его результат.

### Запуск приложения

Для пробного запуска проекта можно воспользоваться базой данных, которая работает через 
**Docker Compose** настройки которого находятся в файле `docker-compose.yml`.

Ниже будут представлены команды и их пояснение для выполнения:

Сначала запустим базу данных через **Docker Compose**:

```text
docker-compose up
```

Появится информация о запуске базы данных и будет доступен **Adminer** 
по адресу: http://localhost:8081/. Входить в базу данных **_необязательно_**,
но для входа можно указать следующие данные:

```text
Драйвер PostgreSQL
Сервер: db
Пользователь: postgres
Пароль: password
База данных: cinema
```

После запуска контейнера будет чистая база данных, чтобы ее заполнить нужно выполнить следующую команду:

```text
mvn liquibase:update --activate-profiles production
```

После этой команды **Liquibase** применит миграции и заполнит базу данных тестовыми данными.

Затем мы запускаем приложение с помощью команды:

```text
mvn spring-boot:run
```

После того как в терминале появится информация об успешном запуске приложения, можно в браузере перейти
по адресу: http://localhost:8080/.

Для остановки сервиса **Кинотеатр** и **Docker Compose** необходимо в окне терминала,
запущенного приложения, нажать сочетания клавиш: `Ctrl + C`.

## Взаимодействие с приложением

## Контакты

Спасибо, что дочитали до конца, данный сервис реализован мной. Открыт для вопросов и предложений.

С уважением Евгений Новоселов.

Телеграмм: https://t.me/enovoselov